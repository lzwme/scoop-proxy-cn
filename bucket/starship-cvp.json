{
  "version": "0.20230505",
  "description": "Starship helper utils",
  "homepage": "https://starship.rs",
  "license": "MIT",
  "notes": [
    "Starship helper utils"
  ],
  "depends": [
    "sudo",
    "clink-cvp",
    "nushell-cvp",
    "starship"
  ],
  "url": "https://github.com/excitoon/empty/releases/download/empty-1.0.7/empty-1.0.7.zip",
  "hash": "8739c76e681f900923b900c9df0ef75cf421d39cabb54650c4b9ad19b6a76d85",
  "pre_install": [
    "",
    "$evalDir = \"$(appdir nu $global)\\current\".Replace('/', '\\')",
    "$PATH = \"$env:PATH;$evalDir\"",
    "$evalDir = \"$(appdir starship $global)\\current\".Replace('/', '\\')",
    "$PATH = \"$PATH;$evalDir\"",
    "#Write-Host \":: var:PATH=$PATH\" -ForegroundColor DarkCyan",
    "[Environment]::SetEnvironmentVariable('PATH', \"$PATH\", 'Process')",
    "Write-Host \":: env:PATH=$env:PATH\" -ForegroundColor DarkCyan",
    "$evalDir = \"$(appdir nushell-cvp $global)\\current\".Replace('/', '\\')",
    "$unixEvalDir = \"$evalDir\".Replace('\\', '/')",
    "$unixDir = \"$dir\".Replace('\\', '/')",
    "",
    "'.cache', 'profile' | ForEach-Object { ensure \"$dir\\$_\" | Out-Null }",
    "",
    "$cachedir = \"$env:USERPROFILE/.cache\"",
    "ensure $cachedir | Out-Null",
    "$cachedir = \"$env:USERPROFILE/.cache/starship\"",
    "",
    "Write-Host \":: Linking $(friendly_path $cachedir) => $(friendly_path $dir/.cache)\" -ForegroundColor DarkCyan",
    "",
    "if (Test-Path -LiteralPath $cachedir -PathType 'Container') {",
    "    sudo cmd /c rmdir \"$cachedir\".Replace('/', '\\')",
    "}",
    "New-Item -ItemType Junction -Path \"$cachedir\" -Value $dir/.cache | Out-Null",
    "",
    "",
    "Write-Host \":: Create profile for clink/starship.lua...\" -ForegroundColor DarkCyan",
    "$ofile = \"$dir/profile/starship.lua\"",
    "$cont = \"load(io.popen('starship init cmd'):read(\"\"*a\"\"))()\"",
    "Set-Content \"$ofile\" \"$cont\" -Encoding ASCII",
    "",
    "Write-Host \":: Create script for start starship by clink...\" -ForegroundColor DarkCyan",
    "#ensure $dir/profile | Out-Null",
    "$ofile = \"$dir/starship_by_clink.cmd\"",
    "$cont = \"@cmd.exe /s /k clink inject --profile $unixDir/profile\"",
    "Set-Content \"$ofile\" \"$cont\" -Encoding ASCII",
    "",
    "Write-Host \":: Allow called by 'starship_by_clink'\" -ForegroundColor DarkCyan",
    "",
    "Write-Host \":: Create script for start starship by nushell...\" -ForegroundColor DarkCyan",
    "#ensure $dir/profile | Out-Null",
    "$ofile = \"$dir/starship_by_nushell.cmd\"",
    "$cont = \"@cmd.exe /s /k nu --config $unixDir/profile/config.nu\"",
    "Set-Content \"$ofile\" \"$cont\" -Encoding ASCII",
    "",
    "Write-Host \":: Allow called by 'starship_by_nushell'\" -ForegroundColor DarkCyan",
    "",
    "",
    "$evalDir = \"$(appdir nushell-cvp $global)\\current\".Replace('/', '\\')",
    "$unixEvalDir = \"$evalDir\".Replace('\\', '/')",
    "$unixDir = \"$dir\".Replace('\\', '/')",
    "",
    "#$nu.config-path",
    "$ifile = \"$(appdir nushell-cvp $global)/current/AppData/config.nu\"",
    "Write-Host \":: Create script for generate config.nu...\" -ForegroundColor DarkCyan",
    "$ofile = \"$dir/cmd_gen_config_nu.cmd\"",
    "$cont = \"@chcp 65001 >nul&@set LANG=zh_CN\n@echo 'Y' | nu\"",
    "Set-Content \"$ofile\" \"$cont\" -Encoding ASCII",
    "$proc = Start-Process -FilePath \"$ofile\" -PassThru",
    "do {",
    "    Start-Sleep -Milliseconds 250",
    "} while (-not(Test-Path -Path \"$ifile\" -PathType Leaf))",
    "$nuproc = Get-Process \"nu\" -ErrorAction SilentlyContinue",
    "$nuproc | Stop-Process -Force #$proc | kill",
    "Remove-Item \"$ofile\"",
    "",
    "",
    "Write-Host \":: Config for start starship by nushell...\" -ForegroundColor DarkCyan",
    "cmd.exe /c \"starship init nu > $dir/.cache/init.nu\"",
    "$ofile = \"$dir/cmd_gen_init_nu.cmd\"",
    "$cont = \"@chcp 65001 >nul&@set LANG=zh_CN\n@starship init nu > $dir/.cache/init.nu\"",
    "Set-Content \"$ofile\" \"$cont\" -Encoding ASCII",
    "$proc = Start-Process -FilePath \"$ofile\" -Wait",
    "",
    "$ifile = \"$(appdir nushell-cvp $global)/current/AppData/config.nu\"",
    "$ofile = \"$dir/profile/config.nu\"",
    "$cont_append = \"source $unixDir/.cache/init.nu\"",
    "$cont = (Get-Content \"$ifile\")",
    "$found = $false",
    "foreach($current_line in $cont)",
    "{",
    "    $det = $current_line.Contains($cont_append)",
    "    if($det)",
    "    {",
    "        $found = $det",
    "        break",
    "    }",
    "}",
    "if ($found) {",
    "    Write-Host \":: Nushell config.nu has been patched before...\" -ForegroundColor DarkCyan",
    "} else {",
    "    #Write-Output \"$cont_append\" | Out-File -Append -encoding \"ASCII\" \"$ofile\"",
    "    $cont += \"\"",
    "    $cont += $cont_append",
    "    $cont += \"\"",
    "    Set-Content \"$ofile\" ($cont -join \"`r`n\") -Encoding ASCII",
    "    Write-Host \":: Nushell config.nu patched done...\" -ForegroundColor DarkCyan",
    "}",
    "",
    "Write-Host \":: Allow called by 'starship_by_clink'\" -ForegroundColor DarkCyan",
    "",
    ""
  ],
  "post_install": [],
  "bin": [
    "starship_by_clink.cmd",
    "starship_by_nushell.cmd"
  ],
  "persist": "profile"
}